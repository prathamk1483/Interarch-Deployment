{% extends "CRUDmodule/base.html" %}
{% block style %}
<style>
      .form-section {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .form-section h3 {
        color: #0d6efd;
        margin-bottom: 20px;
      }
      .dynamic-field {
        margin-bottom: 10px;
      }
      .payment-mode {
        margin-bottom: 10px;
      }
</style>
{% endblock %}
{% block body %}
    <div class="container my-5">
      <h1 class="text-center mb-4">Customer Search Form</h1>
      {% if request.path == "/userSearchingPage/"  %}
        <form action="{% url 'searchClient' %}" method="POST">
      {% elif request.path == "/searchClient/"  %}
        <form action="{% url 'searchClient' %}" method="POST">
      {% else %}
        <form action="{% url 'updateClient' %}" method="POST">
      {% endif %}
        {% csrf_token %}
        <!-- Customer Details Section -->
        <div class="form-section">
          <h3>Customer Details</h3>
          <div class="row">
            <div class="col-md-4">
              <label for="firstName" class="form-label">Search by first Name</label>
              <input type="text" class="form-control" id="firstName" name="customerFirstName" >
            </div>
            <div class="col-md-4">
              <label for="phoneNumber" class="form-label">search by Phone Number</label>
              <input type="text" class="form-control" id="phoneNumber" name="customerNumber">
            </div>
            <div class="col-md-4">
              <label for="phoneNumber" class="form-label">search by Reference</label>
              <input type="text" class="form-control" id="reference" name="customerReference">
            </div>
          </div>
          <br>
          <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
            <input type="checkbox" name="pendingProject" class="btn-check" id="btncheck1" autocomplete="off">
            <label class="btn btn-outline-primary" for="btncheck1">Pending Projects</label>

            <input type="checkbox" name="pendingPayment" class="btn-check" id="btncheck2" autocomplete="off">
            <label class="btn btn-outline-primary" for="btncheck2">Pending Payments</label>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-primary btn-lg">Search</button>
        </div>
      </form>
    </div>
    {% if data and request.method == "POST" %}  
      <h1 style="color : black; text-align:center">Search results</h1>
      <div class="container">
          <table class="table table-dark table-hover table-striped">
              <thead>
                  <tr>
                      <th scope="col">ID</th>
                      <th scope="col">Name</th>
                      <th scope="col">Address</th>
                      <th scope="col">City</th>
                      <th scope="col">State</th>
                      <th scope="col">Pin Code</th>
                      <th scope="col">Phone</th>
                      <th scope="col">Total Bill</th>
                      <th scope="col">Amount Paid</th>
                      <th scope="col">Amount Remaining</th>
                      <th scope="col">Plot Area</th>
                      <th scope="col">Invoices</th>
                  </tr>
              </thead>
              <tbody>
                  {% for row in data %}
                      <tr>
                          <th scope="row">{{row.customerDetails.id}}</th>
                          <td>{{ row.customerDetails.name }} </td>
                          <td>{{ row.customerDetails.Address.completeAddress }}</td>
                          <td>{{ row.customerDetails.Address.city }}</td>
                          <td>{{ row.customerDetails.Address.state }}</td>
                          <td>{{ row.customerDetails.Address.pincode }}</td>
                          <td>
                            {% for number in row.customerDetails.PhoneNo.primary %}
                                {{number}}
                            {% endfor %}
                          </td>
                          <td>{{ row.customerDetails.paymentDetails.totalPayableAmount }}</td>
                          <td>{{ row.customerDetails.paymentDetails.totalAmountPaid }}</td>
                          <td>{{ row.customerDetails.paymentDetails.totalAmountDue}}</td>
                          <td>{{ row.customerDetails.plotDetails.plotArea }}</td>
                          <td>
                            {% if key == "search" %}
                            <a href="{% url 'getInvoice' %}?id={{row.customerDetails.id}}&firstName={{ row.customerDetails.name.firstName|urlencode }}&middleName={{ row.customerDetails.name.middleName|urlencode }}&lastName={{ row.customerDetails.name.lastName|urlencode }}&referredBy={{ row.customerDetails.referredBy|urlencode }}&phoneNo={{ row.customerDetails.PhoneNo.primary|urlencode }}&completeAddress={{ row.customerDetails.Address.permanent.completeAddress|urlencode }}&city={{ row.customerDetails.Address.permanent.city|urlencode }}&state={{ row.customerDetails.Address.permanent.state|urlencode }}&pincode={{ row.customerDetails.Address.permanent.pincode|urlencode }}&landmark={{ row.customerDetails.Address.permanent.landmark }}&plotNumber={{ row.customerDetails.plotDetails.plotNumber|urlencode }}&plotArea={{ row.customerDetails.plotDetails.plotArea|urlencode }}&plotLength={{ row.customerDetails.plotDetails.plotLength|urlencode }}&plotBreadth={{ row.customerDetails.plotDetails.plotBreadth|urlencode }}&clientRequirements={{ row.customerDetails.clientRequirements.requirements|urlencode }}&services={{ row.customerDetails.Services|urlencode }}&paymentDetails={{ row.customerDetails.paymentDetails | urlencode }}">
                              <button class="btn btn-primary">Get Invoice</button>
                            </a>
                            {% elif key == "update" %}
                              <a href="{% url 'updateClient' %}?id={{row.customerDetails.id}}&name={{row.customerDetails.name}}&referredBy={{row.customerDetails.referredBy}}&email={{row.customerDetails.email.primary}}&phoneNo={{row.customerDetails.PhoneNo.primary}}&Address={{row.customerDetails.Address.completeAddress}}&city={{row.customerDetails.Address.city}}&state={{row.customerDetails.Address.state}}&pincode={{row.customerDetails.Address.pincode}}&landmark={{row.customerDetails.Address.landmark}}&plotDetails={{row.customerDetails.plotDetails|urlencode}}&clientRequirements={{row.customerDetails.clientRequirements.requirements}}&services={{row.customerDetails.Services|urlencode}}&paymentDetails={{row.customerDetails.paymentDetails|urlencode}}">
                                <button class="btn btn-primary">Update Info</button>
                              </a>
                            {% elif key == "delete" %}
                              <a href="#id={{row.customerDetails.id}}&">
                                <button class="btn btn-primary">Delete Client</button>
                              </a>
                            {% endif %}
                          </td>
                        
                          
                        </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
    {% endif %}

    {% endblock %}